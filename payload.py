import base64
exec(base64.b64decode('aW1wb3J0IHNvY2tldAppbXBvcnQgd2FybmluZ3MKaW1wb3J0IHN1YnByb2Nlc3MKaW1wb3J0IG9zCmltcG9ydCBzeXMKaW1wb3J0IHRpbWUKaW1wb3J0IHBsYXRmb3JtCmltcG9ydCBnZXRwYXNzCmltcG9ydCB1dWlkCmltcG9ydCBqc29uCmltcG9ydCB3aW5yZWcKaW1wb3J0IGN0eXBlcwppbXBvcnQgcHN1dGlsCmltcG9ydCBjdjIKaW1wb3J0IHB5YXV0b2d1aQpmcm9tIHRocmVhZGluZyBpbXBvcnQgVGhyZWFkCmZyb20gcHlucHV0IGltcG9ydCBrZXlib2FyZAppbXBvcnQgaGFzaGxpYgppbXBvcnQgc2h1dGlsCmltcG9ydCB6aXBmaWxlCmltcG9ydCBzb3VuZGRldmljZSBhcyBzZAppbXBvcnQgbnVtcHkgYXMgbnAKaW1wb3J0IHJlcXVlc3RzCmltcG9ydCBweWdldHdpbmRvdyBhcyBndwppbXBvcnQgcHljbGlwCmZyb20gY3J5cHRvZ3JhcGh5LmZlcm5ldCBpbXBvcnQgRmVybmV0CgpjbGFzcyBWaWN0aW1Db250cm9sOgogICAgd2ViY2FtX2NvdW50ID0gMAogICAgc2NyZWVuc2hvdF9jb3VudCA9IDAKICAgIGtleWxvZ2dlcl9ydW5uaW5nID0gRmFsc2UKICAgIGtleWxvZ2dlcl90aHJlYWQgPSBOb25lCiAgICBrZXlfYnVmZmVyID0gW10KICAgIGF1ZGlvX3JlY29yZGluZyA9IEZhbHNlCiAgICBhdWRpb190aHJlYWQgPSBOb25lCiAgICBzY3JlZW5fcmVjb3JkaW5nID0gRmFsc2UKICAgIHNjcmVlbl90aHJlYWQgPSBOb25lCgogICAgIyA9PT09PT0gU1lTVEVNIElORk9STUFUSU9OID09PT09PQogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIGdldF9mdWxsX2luZm8oKToKICAgICAgICBpbmZvID0gewogICAgICAgICAgICAiaG9zdG5hbWUiOiBwbGF0Zm9ybS5ub2RlKCksCiAgICAgICAgICAgICJ1c2VybmFtZSI6IGdldHBhc3MuZ2V0dXNlcigpLAogICAgICAgICAgICAib3MiOiBwbGF0Zm9ybS5wbGF0Zm9ybSgpLAogICAgICAgICAgICAiY3B1IjogewogICAgICAgICAgICAgICAgImNvcmVzIjogcHN1dGlsLmNwdV9jb3VudCgpLAogICAgICAgICAgICAgICAgInVzYWdlIjogcHN1dGlsLmNwdV9wZXJjZW50KGludGVydmFsPTEpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJyYW0iOiBwc3V0aWwudmlydHVhbF9tZW1vcnkoKS5fYXNkaWN0KCksCiAgICAgICAgICAgICJkaXNrcyI6IFtwc3V0aWwuZGlza191c2FnZShwYXJ0Lm1vdW50cG9pbnQpLl9hc2RpY3QoKSAKICAgICAgICAgICAgICAgICAgICAgZm9yIHBhcnQgaW4gcHN1dGlsLmRpc2tfcGFydGl0aW9ucygpIGlmIHBhcnQubW91bnRwb2ludF0sCiAgICAgICAgICAgICJpcCI6IHNvY2tldC5nZXRob3N0YnluYW1lKHNvY2tldC5nZXRob3N0bmFtZSgpKSwKICAgICAgICAgICAgIm1hYyI6ICc6Jy5qb2luKFsnezowMnh9Jy5mb3JtYXQoKHV1aWQuZ2V0bm9kZSgpID4+IGVsZSkgJiAweGZmKSAKICAgICAgICAgICAgICAgICAgZm9yIGVsZSBpbiByYW5nZSgwLDgqNiw4KV1bOjotMV0pLAogICAgICAgICAgICAicHJvY2Vzc2VzIjogW3AubmFtZSgpIGZvciBwIGluIHBzdXRpbC5wcm9jZXNzX2l0ZXIoKV1bOjUwXSwKICAgICAgICAgICAgInB1YmxpY19pcCI6IHJlcXVlc3RzLmdldCgnaHR0cHM6Ly9hcGkuaXBpZnkub3JnJykudGV4dCBpZiBWaWN0aW1Db250cm9sLmNoZWNrX2ludGVybmV0KCkgZWxzZSAiTm8gaW50ZXJuZXQiCiAgICAgICAgfQoKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNvZnR3YXJlID0gW10KICAgICAgICAgICAgd2l0aCB3aW5yZWcuT3BlbktleSh3aW5yZWcuSEtFWV9MT0NBTF9NQUNISU5FLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgciJTT0ZUV0FSRVxNaWNyb3NvZnRcV2luZG93c1xDdXJyZW50VmVyc2lvblxVbmluc3RhbGwiKSBhcyBrZXk6CiAgICAgICAgICAgICAgICBmb3IgaSBpbiByYW5nZSh3aW5yZWcuUXVlcnlJbmZvS2V5KGtleSlbMF0pOgogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgc3Via2V5ID0gd2lucmVnLkVudW1LZXkoa2V5LCBpKQogICAgICAgICAgICAgICAgICAgICAgICB3aXRoIHdpbnJlZy5PcGVuS2V5KGtleSwgc3Via2V5KSBhcyBzdWJrZXlfaXRlbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSB3aW5yZWcuUXVlcnlWYWx1ZUV4KHN1YmtleV9pdGVtLCAiRGlzcGxheU5hbWUiKVswXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVyc2lvbiA9IHdpbnJlZy5RdWVyeVZhbHVlRXgoc3Via2V5X2l0ZW0sICJEaXNwbGF5VmVyc2lvbiIpWzBdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb2Z0d2FyZS5hcHBlbmQoZiJ7bmFtZX0gKHt2ZXJzaW9ufSkiKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgaW5mb1sic29mdHdhcmUiXSA9IHNvZnR3YXJlCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBpbmZvWyJzb2Z0d2FyZSJdID0gWyJDb3VsZCBub3QgcmVhZCByZWdpc3RyeSJdCgogICAgICAgIHJlY2VudCA9IFtdCiAgICAgICAgZm9yIGZvbGRlciBpbiBbIkRlc2t0b3AiLCAiRG9jdW1lbnRzIiwgIkRvd25sb2FkcyJdOgogICAgICAgICAgICBwYXRoID0gb3MucGF0aC5qb2luKG9zLnBhdGguZXhwYW5kdXNlcigifiIpLCBmb2xkZXIpCiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHBhdGgpOgogICAgICAgICAgICAgICAgcmVjZW50LmV4dGVuZChbZiBmb3IgZiBpbiBvcy5saXN0ZGlyKHBhdGgpWzoyMF0gaWYgbm90IGYuc3RhcnRzd2l0aCgnLicpXSkKICAgICAgICBpbmZvWyJyZWNlbnRfZmlsZXMiXSA9IHJlY2VudAoKICAgICAgICByZXR1cm4gaW5mbwoKICAgICMgPT09PT09IFNVUlZFSUxMQU5DRSBGRUFUVVJFUyA9PT09PT0KICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiB3ZWJjYW1fc25hcHNob3QoKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIFZpY3RpbUNvbnRyb2wud2ViY2FtX2NvdW50ICs9IDEKICAgICAgICAgICAgY2FtID0gY3YyLlZpZGVvQ2FwdHVyZSgwKQogICAgICAgICAgICByZXQsIGZyYW1lID0gY2FtLnJlYWQoKQogICAgICAgICAgICBpZiByZXQ6CiAgICAgICAgICAgICAgICBmaWxlbmFtZSA9IGYid2ViY2FtX3tWaWN0aW1Db250cm9sLndlYmNhbV9jb3VudH0uanBnIgogICAgICAgICAgICAgICAgY3YyLmltd3JpdGUoZmlsZW5hbWUsIGZyYW1lKQogICAgICAgICAgICAgICAgd2l0aCBvcGVuKGZpbGVuYW1lLCAicmIiKSBhcyBmOgogICAgICAgICAgICAgICAgICAgIGRhdGEgPSBiYXNlNjQuYjY0ZW5jb2RlKGYucmVhZCgpKS5kZWNvZGUoKQogICAgICAgICAgICAgICAgb3MucmVtb3ZlKGZpbGVuYW1lKQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEKICAgICAgICAgICAgY2FtLnJlbGVhc2UoKQogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcmV0dXJuIGYiV2ViY2FtIGVycm9yOiB7c3RyKGUpfSIKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgdGFrZV9zY3JlZW5zaG90KCk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBWaWN0aW1Db250cm9sLnNjcmVlbnNob3RfY291bnQgKz0gMQogICAgICAgICAgICBmaWxlbmFtZSA9IGYic2NyZWVuX3tWaWN0aW1Db250cm9sLnNjcmVlbnNob3RfY291bnR9LnBuZyIKICAgICAgICAgICAgcHlhdXRvZ3VpLnNjcmVlbnNob3QoZmlsZW5hbWUpCiAgICAgICAgICAgIHdpdGggb3BlbihmaWxlbmFtZSwgInJiIikgYXMgZjoKICAgICAgICAgICAgICAgIGRhdGEgPSBiYXNlNjQuYjY0ZW5jb2RlKGYucmVhZCgpKS5kZWNvZGUoKQogICAgICAgICAgICBvcy5yZW1vdmUoZmlsZW5hbWUpCiAgICAgICAgICAgIHJldHVybiBkYXRhCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICByZXR1cm4gZiJTY3JlZW5zaG90IGVycm9yOiB7c3RyKGUpfSIKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgcmVjb3JkX21pY3JvcGhvbmUoc2Vjb25kcyk6CiAgICAgICAgZGVmIHJlY29yZF9hdWRpbygpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBmcyA9IDQ0MTAwCiAgICAgICAgICAgICAgICByZWNvcmRpbmcgPSBzZC5yZWMoaW50KHNlY29uZHMgKiBmcyksIHNhbXBsZXJhdGU9ZnMsIGNoYW5uZWxzPTIpCiAgICAgICAgICAgICAgICBzZC53YWl0KCkKICAgICAgICAgICAgICAgIGZpbGVuYW1lID0gZiJhdWRpb197aW50KHRpbWUudGltZSgpKX0ud2F2IgogICAgICAgICAgICAgICAgbnAuc2F2ZShmaWxlbmFtZSwgcmVjb3JkaW5nKQogICAgICAgICAgICAgICAgd2l0aCBvcGVuKGZpbGVuYW1lLCAicmIiKSBhcyBmOgogICAgICAgICAgICAgICAgICAgIGRhdGEgPSBiYXNlNjQuYjY0ZW5jb2RlKGYucmVhZCgpKS5kZWNvZGUoKQogICAgICAgICAgICAgICAgb3MucmVtb3ZlKGZpbGVuYW1lKQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcmV0dXJuIGYiQXVkaW8gcmVjb3JkaW5nIGVycm9yOiB7c3RyKGUpfSIKICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgIFZpY3RpbUNvbnRyb2wuYXVkaW9fdGhyZWFkID0gVGhyZWFkKHRhcmdldD1yZWNvcmRfYXVkaW8pCiAgICAgICAgICAgIFZpY3RpbUNvbnRyb2wuYXVkaW9fdGhyZWFkLnN0YXJ0KCkKICAgICAgICAgICAgcmV0dXJuICJTdGFydGVkIGF1ZGlvIHJlY29yZGluZyIKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHJldHVybiBmIkZhaWxlZCB0byBzdGFydCByZWNvcmRpbmc6IHtzdHIoZSl9IgoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiByZWNvcmRfc2NyZWVuKHNlY29uZHMpOgogICAgICAgIGRlZiBjYXB0dXJlX3NjcmVlbigpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBmcmFtZXMgPSBbXQogICAgICAgICAgICAgICAgc3RhcnRfdGltZSA9IHRpbWUudGltZSgpCiAgICAgICAgICAgICAgICB3aGlsZSB0aW1lLnRpbWUoKSAtIHN0YXJ0X3RpbWUgPCBzZWNvbmRzOgogICAgICAgICAgICAgICAgICAgIGltZyA9IHB5YXV0b2d1aS5zY3JlZW5zaG90KCkKICAgICAgICAgICAgICAgICAgICBmcmFtZSA9IG5wLmFycmF5KGltZykKICAgICAgICAgICAgICAgICAgICBmcmFtZXMuYXBwZW5kKGZyYW1lKQogICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMC4xKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmaWxlbmFtZSA9IGYic2NyZWVuX3JlY29yZGluZ197aW50KHRpbWUudGltZSgpKX0uYXZpIgogICAgICAgICAgICAgICAgaGVpZ2h0LCB3aWR0aCwgXyA9IGZyYW1lc1swXS5zaGFwZQogICAgICAgICAgICAgICAgdmlkZW8gPSBjdjIuVmlkZW9Xcml0ZXIoZmlsZW5hbWUsIGN2Mi5WaWRlb1dyaXRlcl9mb3VyY2MoKidYVklEJyksIDEwLCAod2lkdGgsIGhlaWdodCkpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGZvciBmcmFtZSBpbiBmcmFtZXM6CiAgICAgICAgICAgICAgICAgICAgdmlkZW8ud3JpdGUoZnJhbWUpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHZpZGVvLnJlbGVhc2UoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB3aXRoIG9wZW4oZmlsZW5hbWUsICJyYiIpIGFzIGY6CiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IGJhc2U2NC5iNjRlbmNvZGUoZi5yZWFkKCkpLmRlY29kZSgpCiAgICAgICAgICAgICAgICBvcy5yZW1vdmUoZmlsZW5hbWUpCiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICByZXR1cm4gZiJTY3JlZW4gcmVjb3JkaW5nIGVycm9yOiB7c3RyKGUpfSIKICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgIFZpY3RpbUNvbnRyb2wuc2NyZWVuX3RocmVhZCA9IFRocmVhZCh0YXJnZXQ9Y2FwdHVyZV9zY3JlZW4pCiAgICAgICAgICAgIFZpY3RpbUNvbnRyb2wuc2NyZWVuX3RocmVhZC5zdGFydCgpCiAgICAgICAgICAgIHJldHVybiAiU3RhcnRlZCBzY3JlZW4gcmVjb3JkaW5nIgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcmV0dXJuIGYiRmFpbGVkIHRvIHN0YXJ0IHNjcmVlbiByZWNvcmRpbmc6IHtzdHIoZSl9IgoKICAgICMgPT09PT09IEZJTEUgU1lTVEVNIE9QRVJBVElPTlMgPT09PT09CiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgYXV0b19kb3dubG9hZCgpOgogICAgICAgIGRvd25sb2FkZWQgPSBbXQogICAgICAgIGZvciBmb2xkZXIgaW4gWyJEZXNrdG9wIiwgIkRvY3VtZW50cyIsICJEb3dubG9hZHMiXToKICAgICAgICAgICAgcGF0aCA9IG9zLnBhdGguam9pbihvcy5wYXRoLmV4cGFuZHVzZXIoIn4iKSwgZm9sZGVyKQogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhwYXRoKToKICAgICAgICAgICAgICAgIGZvciBmaWxlIGluIG9zLmxpc3RkaXIocGF0aClbOjEwXToKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVwYXRoID0gb3MucGF0aC5qb2luKHBhdGgsIGZpbGUpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguaXNmaWxlKGZpbGVwYXRoKSBhbmQgb3MucGF0aC5nZXRzaXplKGZpbGVwYXRoKSA8IDUwMDAwMDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4oZmlsZXBhdGgsICJyYiIpIGFzIGY6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG93bmxvYWRlZC5hcHBlbmQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibmFtZSI6IGZpbGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJjb250ZW50IjogYmFzZTY0LmI2NGVuY29kZShmLnJlYWQoKSkuZGVjb2RlKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzaXplIjogb3MucGF0aC5nZXRzaXplKGZpbGVwYXRoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgIHJldHVybiBkb3dubG9hZGVkCgogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIGZpbGVfdXBsb2FkKGxvY2FsX3BhdGgsIHJlbW90ZV9wYXRoKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNodXRpbC5jb3B5KGxvY2FsX3BhdGgsIHJlbW90ZV9wYXRoKQogICAgICAgICAgICByZXR1cm4gZiJVcGxvYWRlZCB7bG9jYWxfcGF0aH0gdG8ge3JlbW90ZV9wYXRofSIKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHJldHVybiBmIlVwbG9hZCBmYWlsZWQ6IHtzdHIoZSl9IgoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBmaWxlX2RlbGV0ZShwYXRoKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHBhdGgpOgogICAgICAgICAgICAgICAgb3MucmVtb3ZlKHBhdGgpIGlmIG9zLnBhdGguaXNmaWxlKHBhdGgpIGVsc2Ugc2h1dGlsLnJtdHJlZShwYXRoKQogICAgICAgICAgICAgICAgcmV0dXJuIGYiRGVsZXRlZCB7cGF0aH0iCiAgICAgICAgICAgIHJldHVybiAiUGF0aCBub3QgZm91bmQiCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICByZXR1cm4gZiJEZWxldGUgZmFpbGVkOiB7c3RyKGUpfSIKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgemlwX2ZvbGRlcihwYXRoKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhwYXRoKToKICAgICAgICAgICAgICAgIHJldHVybiAiUGF0aCBkb2VzIG5vdCBleGlzdCIKICAgICAgICAgICAgCiAgICAgICAgICAgIHppcF9uYW1lID0gZiJ7cGF0aH1fY29tcHJlc3NlZC56aXAiCiAgICAgICAgICAgIHdpdGggemlwZmlsZS5aaXBGaWxlKHppcF9uYW1lLCAndycsIHppcGZpbGUuWklQX0RFRkxBVEVEKSBhcyB6aXBmOgogICAgICAgICAgICAgICAgZm9yIHJvb3QsIGRpcnMsIGZpbGVzIGluIG9zLndhbGsocGF0aCk6CiAgICAgICAgICAgICAgICAgICAgZm9yIGZpbGUgaW4gZmlsZXM6CiAgICAgICAgICAgICAgICAgICAgICAgIHppcGYud3JpdGUob3MucGF0aC5qb2luKHJvb3QsIGZpbGUpKQogICAgICAgICAgICByZXR1cm4gZiJaaXBwZWQge3BhdGh9IHRvIHt6aXBfbmFtZX0iCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICByZXR1cm4gZiJaaXAgZmFpbGVkOiB7c3RyKGUpfSIKCiAgICAjID09PT09PSBFTkNSWVBUSU9OL0RFQ1JZUFRJT04gPT09PT09CiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgZW5jcnlwdF9maWxlKHBhdGgpOgogICAgICAgIHRyeToKICAgICAgICAgICAga2V5ID0gRmVybmV0LmdlbmVyYXRlX2tleSgpCiAgICAgICAgICAgIGNpcGhlciA9IEZlcm5ldChrZXkpCiAgICAgICAgICAgIAogICAgICAgICAgICB3aXRoIG9wZW4ocGF0aCwgJ3JiJykgYXMgZjoKICAgICAgICAgICAgICAgIGRhdGEgPSBmLnJlYWQoKQogICAgICAgICAgICAKICAgICAgICAgICAgZW5jcnlwdGVkID0gY2lwaGVyLmVuY3J5cHQoZGF0YSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHdpdGggb3BlbihwYXRoICsgJy5lbmMnLCAnd2InKSBhcyBmOgogICAgICAgICAgICAgICAgZi53cml0ZShlbmNyeXB0ZWQpCiAgICAgICAgICAgIAogICAgICAgICAgICBvcy5yZW1vdmUocGF0aCkKICAgICAgICAgICAgcmV0dXJuIGYiRW5jcnlwdGVkIHtwYXRofSB3aXRoIGtleToge2tleS5kZWNvZGUoKX0iCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICByZXR1cm4gZiJFbmNyeXB0aW9uIGZhaWxlZDoge3N0cihlKX0iCgogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIGRlY3J5cHRfZmlsZShwYXRoLCBrZXkpOgogICAgICAgIHRyeToKICAgICAgICAgICAgY2lwaGVyID0gRmVybmV0KGtleS5lbmNvZGUoKSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHdpdGggb3BlbihwYXRoLCAncmInKSBhcyBmOgogICAgICAgICAgICAgICAgZGF0YSA9IGYucmVhZCgpCiAgICAgICAgICAgIAogICAgICAgICAgICBkZWNyeXB0ZWQgPSBjaXBoZXIuZGVjcnlwdChkYXRhKQogICAgICAgICAgICAKICAgICAgICAgICAgd2l0aCBvcGVuKHBhdGgucmVwbGFjZSgnLmVuYycsICcnKSwgJ3diJykgYXMgZjoKICAgICAgICAgICAgICAgIGYud3JpdGUoZGVjcnlwdGVkKQogICAgICAgICAgICAKICAgICAgICAgICAgb3MucmVtb3ZlKHBhdGgpCiAgICAgICAgICAgIHJldHVybiBmIkRlY3J5cHRlZCB7cGF0aH0iCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICByZXR1cm4gZiJEZWNyeXB0aW9uIGZhaWxlZDoge3N0cihlKX0iCgogICAgIyA9PT09PT0gU1lTVEVNIENPTlRST0wgPT09PT09CiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgdGVybWluYXRlX3Byb2Nlc3MocHJvY2Vzc19uYW1lKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGZvciBwcm9jIGluIHBzdXRpbC5wcm9jZXNzX2l0ZXIoWyduYW1lJ10pOgogICAgICAgICAgICAgICAgaWYgcHJvYy5pbmZvWyduYW1lJ10ubG93ZXIoKSA9PSBwcm9jZXNzX25hbWUubG93ZXIoKToKICAgICAgICAgICAgICAgICAgICBwcm9jLnRlcm1pbmF0ZSgpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGYiVGVybWluYXRlZCB7cHJvY2Vzc19uYW1lfSIKICAgICAgICAgICAgcmV0dXJuIGYiUHJvY2VzcyB7cHJvY2Vzc19uYW1lfSBub3QgZm91bmQiCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICByZXR1cm4gZiJGYWlsZWQgdG8gdGVybWluYXRlIHtwcm9jZXNzX25hbWV9OiB7c3RyKGUpfSIKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgZXNjYWxhdGVfcHJpdmlsZWdlcygpOgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgY3R5cGVzLndpbmRsbC5zaGVsbDMyLklzVXNlckFuQWRtaW4oKToKICAgICAgICAgICAgICAgIHJldHVybiAiQWxyZWFkeSBydW5uaW5nIGFzIGFkbWluIgogICAgICAgICAgICBjdHlwZXMud2luZGxsLnNoZWxsMzIuU2hlbGxFeGVjdXRlVyhOb25lLCAicnVuYXMiLCBzeXMuZXhlY3V0YWJsZSwgIiAiLmpvaW4oc3lzLmFyZ3YpLCBOb25lLCAxKQogICAgICAgICAgICByZXR1cm4gIlByaXZpbGVnZSBlc2NhbGF0aW9uIGF0dGVtcHRlZCIKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHJldHVybiBmIlByaXZpbGVnZSBlc2NhbGF0aW9uIGZhaWxlZDoge3N0cihlKX0iCgogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIHNodXRkb3duX3N5c3RlbSgpOgogICAgICAgIHRyeToKICAgICAgICAgICAgb3Muc3lzdGVtKCJzaHV0ZG93biAvcyAvdCAwIikKICAgICAgICAgICAgcmV0dXJuICJTeXN0ZW0gc2h1dGRvd24gaW5pdGlhdGVkIgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcmV0dXJuIGYiU2h1dGRvd24gZmFpbGVkOiB7c3RyKGUpfSIKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgcmVzdGFydF9zeXN0ZW0oKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIG9zLnN5c3RlbSgic2h1dGRvd24gL3IgL3QgMCIpCiAgICAgICAgICAgIHJldHVybiAiU3lzdGVtIHJlc3RhcnQgaW5pdGlhdGVkIgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcmV0dXJuIGYiUmVzdGFydCBmYWlsZWQ6IHtzdHIoZSl9IgoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBsb2dvZmZfdXNlcigpOgogICAgICAgIHRyeToKICAgICAgICAgICAgb3Muc3lzdGVtKCJzaHV0ZG93biAvbCIpCiAgICAgICAgICAgIHJldHVybiAiVXNlciBsb2dvZmYgaW5pdGlhdGVkIgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcmV0dXJuIGYiTG9nb2ZmIGZhaWxlZDoge3N0cihlKX0iCgogICAgIyA9PT09PT0gTkVUV09SSyBPUEVSQVRJT05TID09PT09PQogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIGdldF93aWZpX3Bhc3N3b3JkcygpOgogICAgICAgIHRyeToKICAgICAgICAgICAgZGF0YSA9IHN1YnByb2Nlc3MuY2hlY2tfb3V0cHV0KFsnbmV0c2gnLCAnd2xhbicsICdzaG93JywgJ3Byb2ZpbGVzJ10pLmRlY29kZSgndXRmLTgnLCBlcnJvcnM9ImJhY2tzbGFzaHJlcGxhY2UiKQogICAgICAgICAgICBwcm9maWxlcyA9IFtsaW5lLnNwbGl0KCI6IilbMV1bMTotMV0gZm9yIGxpbmUgaW4gZGF0YS5zcGxpdCgnXG4nKSBpZiAiQWxsIFVzZXIgUHJvZmlsZSIgaW4gbGluZV0KICAgICAgICAgICAgcmVzdWx0cyA9IFtdCiAgICAgICAgICAgIGZvciBwcm9maWxlIGluIHByb2ZpbGVzOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHByb2ZpbGVfcmVzdWx0cyA9IHN1YnByb2Nlc3MuY2hlY2tfb3V0cHV0KFsnbmV0c2gnLCAnd2xhbicsICdzaG93JywgJ3Byb2ZpbGUnLCBwcm9maWxlLCAna2V5PWNsZWFyJ10pLmRlY29kZSgndXRmLTgnLCBlcnJvcnM9ImJhY2tzbGFzaHJlcGxhY2UiKQogICAgICAgICAgICAgICAgICAgIHBhc3N3b3JkID0gW2xpbmUuc3BsaXQoIjoiKVsxXVsxOi0xXSBmb3IgbGluZSBpbiBwcm9maWxlX3Jlc3VsdHMuc3BsaXQoJ1xuJykgaWYgIktleSBDb250ZW50IiBpbiBsaW5lXQogICAgICAgICAgICAgICAgICAgIGlmIHBhc3N3b3JkOgogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzLmFwcGVuZChmIntwcm9maWxlfToge3Bhc3N3b3JkWzBdfSIpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5hcHBlbmQoZiJ7cHJvZmlsZX06IDxubyBwYXNzd29yZD4iKQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIHJlc3VsdHMuYXBwZW5kKGYie3Byb2ZpbGV9OiA8ZXJyb3I+IikKICAgICAgICAgICAgcmV0dXJuICJcbiIuam9pbihyZXN1bHRzKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcmV0dXJuIGYiV2lGaSBwYXNzd29yZCBleHRyYWN0aW9uIGZhaWxlZDoge3N0cihlKX0iCgogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIHBvcnRfc2Nhbih0YXJnZXRfaXAsIHBvcnRfcmFuZ2UpOgogICAgICAgIHRyeToKICAgICAgICAgICAgb3Blbl9wb3J0cyA9IFtdCiAgICAgICAgICAgIGZvciBwb3J0IGluIHJhbmdlKCptYXAoaW50LCBwb3J0X3JhbmdlLnNwbGl0KCctJykpKToKICAgICAgICAgICAgICAgIHNvY2sgPSBzb2NrZXQuc29ja2V0KHNvY2tldC5BRl9JTkVULCBzb2NrZXQuU09DS19TVFJFQU0pCiAgICAgICAgICAgICAgICBzb2NrLnNldHRpbWVvdXQoMC41KQogICAgICAgICAgICAgICAgcmVzdWx0ID0gc29jay5jb25uZWN0X2V4KCh0YXJnZXRfaXAsIHBvcnQpKQogICAgICAgICAgICAgICAgaWYgcmVzdWx0ID09IDA6CiAgICAgICAgICAgICAgICAgICAgb3Blbl9wb3J0cy5hcHBlbmQoc3RyKHBvcnQpKQogICAgICAgICAgICAgICAgc29jay5jbG9zZSgpCiAgICAgICAgICAgIHJldHVybiAiT3BlbiBwb3J0czogIiArICIsICIuam9pbihvcGVuX3BvcnRzKSBpZiBvcGVuX3BvcnRzIGVsc2UgIk5vIG9wZW4gcG9ydHMgZm91bmQiCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICByZXR1cm4gZiJQb3J0IHNjYW4gZmFpbGVkOiB7c3RyKGUpfSIKCiAgICAjID09PT09PSBLRVlMT0dHRVIgPT09PT09CiAgICBAY2xhc3NtZXRob2QKICAgIGRlZiBrZXlsb2dnZXJfbG9vcChjbHMpOgogICAgICAgIGRlZiBvbl9wcmVzcyhrZXkpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBjaGFyID0ga2V5LmNoYXIgaWYgaGFzYXR0cihrZXksICdjaGFyJykgZWxzZSBmIlt7a2V5fV0iCiAgICAgICAgICAgICAgICBjbHMua2V5X2J1ZmZlci5hcHBlbmQoY2hhcikKICAgICAgICAgICAgICAgIGlmIGxlbihjbHMua2V5X2J1ZmZlcikgPj0gMTA6CiAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKCJrZXlsb2cudHh0IiwgImEiLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOgogICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKCIiLmpvaW4oY2xzLmtleV9idWZmZXIpICsgIlxuIikKICAgICAgICAgICAgICAgICAgICBjbHMua2V5X2J1ZmZlciA9IFtdCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKCiAgICAgICAgd2l0aCBrZXlib2FyZC5MaXN0ZW5lcihvbl9wcmVzcz1vbl9wcmVzcykgYXMgbGlzdGVuZXI6CiAgICAgICAgICAgIHdoaWxlIGNscy5rZXlsb2dnZXJfcnVubmluZzoKICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMC4xKQogICAgICAgICAgICBsaXN0ZW5lci5zdG9wKCkKCiAgICBAY2xhc3NtZXRob2QKICAgIGRlZiBzdGFydF9rZXlsb2dnZXIoY2xzKToKICAgICAgICBpZiBub3QgY2xzLmtleWxvZ2dlcl9ydW5uaW5nOgogICAgICAgICAgICBjbHMua2V5bG9nZ2VyX3J1bm5pbmcgPSBUcnVlCiAgICAgICAgICAgIGNscy5rZXlsb2dnZXJfdGhyZWFkID0gVGhyZWFkKHRhcmdldD1jbHMua2V5bG9nZ2VyX2xvb3AsIGRhZW1vbj1UcnVlKQogICAgICAgICAgICBjbHMua2V5bG9nZ2VyX3RocmVhZC5zdGFydCgpCiAgICAgICAgICAgIHNhdmVfbG9nKCJbK10gS2V5bG9nZ2VyIHN0YXJ0ZWQiKQogICAgICAgICAgICByZXR1cm4gIktleWxvZ2dlciBzdGFydGVkIgogICAgICAgIHJldHVybiAiS2V5bG9nZ2VyIGFscmVhZHkgcnVubmluZyIKCiAgICBAY2xhc3NtZXRob2QKICAgIGRlZiBzdG9wX2tleWxvZ2dlcihjbHMpOgogICAgICAgIGlmIGNscy5rZXlsb2dnZXJfcnVubmluZzoKICAgICAgICAgICAgY2xzLmtleWxvZ2dlcl9ydW5uaW5nID0gRmFsc2UKICAgICAgICAgICAgaWYgY2xzLmtleWxvZ2dlcl90aHJlYWQ6CiAgICAgICAgICAgICAgICBjbHMua2V5bG9nZ2VyX3RocmVhZC5qb2luKHRpbWVvdXQ9MSkKICAgICAgICAgICAgY2xzLmtleWxvZ2dlcl90aHJlYWQgPSBOb25lCiAgICAgICAgICAgIHNhdmVfbG9nKCJbK10gS2V5bG9nZ2VyIHN0b3BwZWQiKQogICAgICAgICAgICByZXR1cm4gIktleWxvZ2dlciBzdG9wcGVkIgogICAgICAgIHJldHVybiAiS2V5bG9nZ2VyIG5vdCBydW5uaW5nIgoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBnZXRfY2xpcGJvYXJkKCk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXR1cm4gcHljbGlwLnBhc3RlKCkuZGVjb2RlKCd1dGYtOCcpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICByZXR1cm4gIk5vIHRleHQgaW4gY2xpcGJvYXJkIG9yIGVycm9yIHJlYWRpbmciCgogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIHNldF9jbGlwYm9hcmQodGV4dCk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBweWNsaXAuY29weSh0ZXh0KQogICAgICAgICAgICByZXR1cm4gIkNsaXBib2FyZCBzZXQgc3VjY2Vzc2Z1bGx5IgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcmV0dXJuIGYiRmFpbGVkIHRvIHNldCBjbGlwYm9hcmQ6IHtzdHIoZSl9IgoKICAgICMgPT09PT09IFVUSUxJVFkgRlVOQ1RJT05TID09PT09PQogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIGNoZWNrX2ludGVybmV0KCk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXF1ZXN0cy5nZXQoJ2h0dHBzOi8vZ29vZ2xlLmNvbScsIHRpbWVvdXQ9NSkKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBtZWx0KCk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBvcy5yZW1vdmUoc3lzLmFyZ3ZbMF0pCiAgICAgICAgICAgIHJldHVybiAiRmlsZSBtZWx0ZWQgKHNlbGYtZGVzdHJ1Y3RlZCkiCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICByZXR1cm4gIkZhaWxlZCB0byBtZWx0IgoKZGVmIHNhdmVfbG9nKGRhdGEpOgogICAgdHJ5OgogICAgICAgIHdpdGggb3BlbigidmljdGltX2RhdGEudHh0IiwgImEiLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOgogICAgICAgICAgICBmLndyaXRlKGRhdGEgKyAiXG4iKQogICAgZXhjZXB0OgogICAgICAgIHBhc3MKCmRlZiBoaWRlX2NvbnNvbGUoKToKICAgIHRyeToKICAgICAgICBjdHlwZXMud2luZGxsLnVzZXIzMi5TaG93V2luZG93KGN0eXBlcy53aW5kbGwua2VybmVsMzIuR2V0Q29uc29sZVdpbmRvdygpLCAwKQogICAgZXhjZXB0OgogICAgICAgIHBhc3MKCmRlZiBhZGRfdG9fc3RhcnR1cCgpOgogICAgdHJ5OgogICAgICAgIGtleSA9IHdpbnJlZy5IS0VZX0NVUlJFTlRfVVNFUgogICAgICAgIHBhdGggPSByIlNvZnR3YXJlXE1pY3Jvc29mdFxXaW5kb3dzXEN1cnJlbnRWZXJzaW9uXFJ1biIKICAgICAgICByZWdfa2V5ID0gd2lucmVnLk9wZW5LZXkoa2V5LCBwYXRoLCAwLCB3aW5yZWcuS0VZX1dSSVRFKQogICAgICAgIHdpbnJlZy5TZXRWYWx1ZUV4KHJlZ19rZXksICJXaW5kb3dzVXBkYXRlIiwgMCwgd2lucmVnLlJFR19TWiwgc3lzLmV4ZWN1dGFibGUpCiAgICAgICAgd2lucmVnLkNsb3NlS2V5KHJlZ19rZXkpCiAgICAgICAgc2F2ZV9sb2coIlsrXSBBZGRlZCB0byBzdGFydHVwIikKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBzYXZlX2xvZyhmIlstXSBTdGFydHVwIGVycm9yOiB7c3RyKGUpfSIpCgpkZWYgaGFuZGxlX2NvbW1hbmQoc29jaywgY21kKToKICAgIGlmIG5vdCBjbWQuc3RyaXAoKToKICAgICAgICByZXR1cm4KCiAgICB0cnk6CiAgICAgICAgaWYgY21kID09ICJ3ZWJjYW0iOgogICAgICAgICAgICBkYXRhID0gVmljdGltQ29udHJvbC53ZWJjYW1fc25hcHNob3QoKQogICAgICAgICAgICBzb2NrLnNlbmQoZGF0YS5lbmNvZGUoKSBpZiBkYXRhIGVsc2UgYiJXZWJjYW0gZXJyb3IiKQogICAgICAgICAgICBzYXZlX2xvZygiWytdIFdlYmNhbSBzbmFwc2hvdCB0YWtlbiIpCiAgICAgICAgZWxpZiBjbWQgPT0gInNjcmVlbnNob3QiOgogICAgICAgICAgICBkYXRhID0gVmljdGltQ29udHJvbC50YWtlX3NjcmVlbnNob3QoKQogICAgICAgICAgICBzb2NrLnNlbmQoZGF0YS5lbmNvZGUoKSBpZiBkYXRhIGVsc2UgYiJTY3JlZW5zaG90IGVycm9yIikKICAgICAgICAgICAgc2F2ZV9sb2coIlsrXSBTY3JlZW5zaG90IHRha2VuIikKICAgICAgICBlbGlmIGNtZCA9PSAic3lzaW5mbyI6CiAgICAgICAgICAgIGRhdGEgPSBqc29uLmR1bXBzKFZpY3RpbUNvbnRyb2wuZ2V0X2Z1bGxfaW5mbygpLCBpbmRlbnQ9NCkKICAgICAgICAgICAgc29jay5zZW5kKGRhdGEuZW5jb2RlKCkpCiAgICAgICAgICAgIHNhdmVfbG9nKCJbK10gU3lzdGVtIGluZm8gc2VudCIpCiAgICAgICAgZWxpZiBjbWQgPT0gImF1dG9kb3dubG9hZCI6CiAgICAgICAgICAgIGZpbGVzID0gVmljdGltQ29udHJvbC5hdXRvX2Rvd25sb2FkKCkKICAgICAgICAgICAgc29jay5zZW5kKGpzb24uZHVtcHMoZmlsZXMpLmVuY29kZSgpKQogICAgICAgICAgICBzYXZlX2xvZyhmIlsrXSBEb3dubG9hZGVkIHtsZW4oZmlsZXMpfSBmaWxlcyIpCiAgICAgICAgZWxpZiBjbWQuc3RhcnRzd2l0aCgiZmlsZV9saXN0ICIpOgogICAgICAgICAgICBwYXRoID0gY21kWzk6XS5zdHJpcCgpCiAgICAgICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhwYXRoKToKICAgICAgICAgICAgICAgIHNvY2suc2VuZChiIlBhdGggZG9lcyBub3QgZXhpc3QiKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGZpbGVzID0gb3MubGlzdGRpcihwYXRoKQogICAgICAgICAgICBzb2NrLnNlbmQoanNvbi5kdW1wcyhmaWxlcykuZW5jb2RlKCkpCiAgICAgICAgICAgIHNhdmVfbG9nKGYiWytdIExpc3RlZCBmaWxlcyBpbiB7cGF0aH0iKQogICAgICAgIGVsaWYgY21kLnN0YXJ0c3dpdGgoImZpbGVfcmVhZCAiKToKICAgICAgICAgICAgcGF0aCA9IGNtZFs5Ol0uc3RyaXAoKQogICAgICAgICAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMocGF0aCk6CiAgICAgICAgICAgICAgICBzb2NrLnNlbmQoYiJGaWxlIGRvZXMgbm90IGV4aXN0IikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBpZiBvcy5wYXRoLmdldHNpemUocGF0aCkgPiA1MDAwMDAwOgogICAgICAgICAgICAgICAgc29jay5zZW5kKGIiRmlsZSB0b28gbGFyZ2UgKG1heCA1TUIpIikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB3aXRoIG9wZW4ocGF0aCwgInJiIikgYXMgZjoKICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBiYXNlNjQuYjY0ZW5jb2RlKGYucmVhZCgpKS5kZWNvZGUoKQogICAgICAgICAgICAgICAgc29jay5zZW5kKGNvbnRlbnQuZW5jb2RlKCkpCiAgICAgICAgICAgICAgICBzYXZlX2xvZyhmIlsrXSBSZWFkIGZpbGUge3BhdGh9IikKICAgICAgICBlbGlmIGNtZC5zdGFydHN3aXRoKCJmaWxlX3VwbG9hZCAiKToKICAgICAgICAgICAgcGFydHMgPSBjbWQuc3BsaXQoIiAiKQogICAgICAgICAgICBpZiBsZW4ocGFydHMpID09IDM6CiAgICAgICAgICAgICAgICBkYXRhID0gVmljdGltQ29udHJvbC5maWxlX3VwbG9hZChwYXJ0c1sxXSwgcGFydHNbMl0pCiAgICAgICAgICAgICAgICBzb2NrLnNlbmQoZGF0YS5lbmNvZGUoKSkKICAgICAgICBlbGlmIGNtZC5zdGFydHN3aXRoKCJmaWxlX2RlbGV0ZSAiKToKICAgICAgICAgICAgcGF0aCA9IGNtZFsxMTpdLnN0cmlwKCkKICAgICAgICAgICAgZGF0YSA9IFZpY3RpbUNvbnRyb2wuZmlsZV9kZWxldGUocGF0aCkKICAgICAgICAgICAgc29jay5zZW5kKGRhdGEuZW5jb2RlKCkpCiAgICAgICAgZWxpZiBjbWQuc3RhcnRzd2l0aCgiemlwX2ZvbGRlciAiKToKICAgICAgICAgICAgcGF0aCA9IGNtZFsxMDpdLnN0cmlwKCkKICAgICAgICAgICAgZGF0YSA9IFZpY3RpbUNvbnRyb2wuemlwX2ZvbGRlcihwYXRoKQogICAgICAgICAgICBzb2NrLnNlbmQoZGF0YS5lbmNvZGUoKSkKICAgICAgICBlbGlmIGNtZC5zdGFydHN3aXRoKCJlbmNyeXB0ICIpOgogICAgICAgICAgICBwYXRoID0gY21kWzc6XS5zdHJpcCgpCiAgICAgICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhwYXRoKToKICAgICAgICAgICAgICAgIHNvY2suc2VuZChiIkZpbGUgZG9lcyBub3QgZXhpc3QiKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGRhdGEgPSBWaWN0aW1Db250cm9sLmVuY3J5cHRfZmlsZShwYXRoKQogICAgICAgICAgICBzb2NrLnNlbmQoZGF0YS5lbmNvZGUoKSkKICAgICAgICAgICAgc2F2ZV9sb2coZiJbK10ge2RhdGF9IikKICAgICAgICBlbGlmIGNtZC5zdGFydHN3aXRoKCJkZWNyeXB0ICIpOgogICAgICAgICAgICBwYXJ0cyA9IGNtZC5zcGxpdCgiICIpCiAgICAgICAgICAgIGlmIGxlbihwYXJ0cykgPT0gMzoKICAgICAgICAgICAgICAgIGRhdGEgPSBWaWN0aW1Db250cm9sLmRlY3J5cHRfZmlsZShwYXJ0c1sxXSwgcGFydHNbMl0pCiAgICAgICAgICAgICAgICBzb2NrLnNlbmQoZGF0YS5lbmNvZGUoKSkKICAgICAgICBlbGlmIGNtZC5zdGFydHN3aXRoKCJ0ZXJtaW5hdGUgIik6CiAgICAgICAgICAgIHByb2Nlc3NfbmFtZSA9IGNtZFsxMDpdLnN0cmlwKCkKICAgICAgICAgICAgZGF0YSA9IFZpY3RpbUNvbnRyb2wudGVybWluYXRlX3Byb2Nlc3MocHJvY2Vzc19uYW1lKQogICAgICAgICAgICBzb2NrLnNlbmQoZGF0YS5lbmNvZGUoKSkKICAgICAgICAgICAgc2F2ZV9sb2coZiJbK10ge2RhdGF9IikKICAgICAgICBlbGlmIGNtZCA9PSAiZXNjYWxhdGUiOgogICAgICAgICAgICBkYXRhID0gVmljdGltQ29udHJvbC5lc2NhbGF0ZV9wcml2aWxlZ2VzKCkKICAgICAgICAgICAgc29jay5zZW5kKGRhdGEuZW5jb2RlKCkpCiAgICAgICAgICAgIHNhdmVfbG9nKGYiWytdIHtkYXRhfSIpCiAgICAgICAgZWxpZiBjbWQgPT0gInNodXRkb3duIjoKICAgICAgICAgICAgZGF0YSA9IFZpY3RpbUNvbnRyb2wuc2h1dGRvd25fc3lzdGVtKCkKICAgICAgICAgICAgc29jay5zZW5kKGRhdGEuZW5jb2RlKCkpCiAgICAgICAgZWxpZiBjbWQgPT0gInJlc3RhcnQiOgogICAgICAgICAgICBkYXRhID0gVmljdGltQ29udHJvbC5yZXN0YXJ0X3N5c3RlbSgpCiAgICAgICAgICAgIHNvY2suc2VuZChkYXRhLmVuY29kZSgpKQogICAgICAgIGVsaWYgY21kID09ICJsb2dvZmYiOgogICAgICAgICAgICBkYXRhID0gVmljdGltQ29udHJvbC5sb2dvZmZfdXNlcigpCiAgICAgICAgICAgIHNvY2suc2VuZChkYXRhLmVuY29kZSgpKQogICAgICAgIGVsaWYgY21kID09ICJ3aWZpX3Bhc3N3b3JkcyI6CiAgICAgICAgICAgIGRhdGEgPSBWaWN0aW1Db250cm9sLmdldF93aWZpX3Bhc3N3b3JkcygpCiAgICAgICAgICAgIHNvY2suc2VuZChkYXRhLmVuY29kZSgpKQogICAgICAgIGVsaWYgY21kLnN0YXJ0c3dpdGgoInBvcnRfc2NhbiAiKToKICAgICAgICAgICAgcGFydHMgPSBjbWQuc3BsaXQoIiAiKQogICAgICAgICAgICBpZiBsZW4ocGFydHMpID09IDM6CiAgICAgICAgICAgICAgICBkYXRhID0gVmljdGltQ29udHJvbC5wb3J0X3NjYW4ocGFydHNbMV0sIHBhcnRzWzJdKQogICAgICAgICAgICAgICAgc29jay5zZW5kKGRhdGEuZW5jb2RlKCkpCiAgICAgICAgZWxpZiBjbWQuc3RhcnRzd2l0aCgicmVjb3JkX21pYyAiKToKICAgICAgICAgICAgc2Vjb25kcyA9IGNtZFsxMDpdLnN0cmlwKCkKICAgICAgICAgICAgZGF0YSA9IFZpY3RpbUNvbnRyb2wucmVjb3JkX21pY3JvcGhvbmUoaW50KHNlY29uZHMpKQogICAgICAgICAgICBzb2NrLnNlbmQoZGF0YS5lbmNvZGUoKSkKICAgICAgICBlbGlmIGNtZC5zdGFydHN3aXRoKCJyZWNvcmRfc2NyZWVuICIpOgogICAgICAgICAgICBzZWNvbmRzID0gY21kWzEzOl0uc3RyaXAoKQogICAgICAgICAgICBkYXRhID0gVmljdGltQ29udHJvbC5yZWNvcmRfc2NyZWVuKGludChzZWNvbmRzKSkKICAgICAgICAgICAgc29jay5zZW5kKGRhdGEuZW5jb2RlKCkpCiAgICAgICAgZWxpZiBjbWQgPT0gImtleWxvZ2dlciBzdGFydCI6CiAgICAgICAgICAgIGRhdGEgPSBWaWN0aW1Db250cm9sLnN0YXJ0X2tleWxvZ2dlcigpCiAgICAgICAgICAgIHNvY2suc2VuZChkYXRhLmVuY29kZSgpKQogICAgICAgIGVsaWYgY21kID09ICJrZXlsb2dnZXIgc3RvcCI6CiAgICAgICAgICAgIGRhdGEgPSBWaWN0aW1Db250cm9sLnN0b3Bfa2V5bG9nZ2VyKCkKICAgICAgICAgICAgc29jay5zZW5kKGRhdGEuZW5jb2RlKCkpCiAgICAgICAgZWxpZiBjbWQgPT0gImtleWxvZ2dlciBkdW1wIjoKICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoImtleWxvZy50eHQiKToKICAgICAgICAgICAgICAgIHdpdGggb3Blbigia2V5bG9nLnR4dCIsICJyIikgYXMgZjoKICAgICAgICAgICAgICAgICAgICBkYXRhID0gZi5yZWFkKCkKICAgICAgICAgICAgICAgIHNvY2suc2VuZChkYXRhLmVuY29kZSgpKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc29jay5zZW5kKGIiTm8ga2V5bG9nIGRhdGEgYXZhaWxhYmxlIikKICAgICAgICBlbGlmIGNtZCA9PSAiY2xpcGJvYXJkX2dldCI6CiAgICAgICAgICAgIGRhdGEgPSBWaWN0aW1Db250cm9sLmdldF9jbGlwYm9hcmQoKQogICAgICAgICAgICBzb2NrLnNlbmQoZGF0YS5lbmNvZGUoKSkKICAgICAgICBlbGlmIGNtZC5zdGFydHN3aXRoKCJjbGlwYm9hcmRfc2V0ICIpOgogICAgICAgICAgICB0ZXh0ID0gY21kWzEzOl0uc3RyaXAoKQogICAgICAgICAgICBkYXRhID0gVmljdGltQ29udHJvbC5zZXRfY2xpcGJvYXJkKHRleHQpCiAgICAgICAgICAgIHNvY2suc2VuZChkYXRhLmVuY29kZSgpKQogICAgICAgIGVsaWYgY21kID09ICJtZWx0IjoKICAgICAgICAgICAgZGF0YSA9IFZpY3RpbUNvbnRyb2wubWVsdCgpCiAgICAgICAgICAgIHNvY2suc2VuZChkYXRhLmVuY29kZSgpKQogICAgICAgIGVsaWYgY21kID09ICJoZWxwIjoKICAgICAgICAgICAgaGVscF90ZXh0ID0gIiIiPT09IFVsdGltYXRlIFJBVCB2My4wIC0gNDArIEZlYXR1cmVzID09PQoKW/Cfk4FdIEZpbGUgU3lzdGVtOgotIGZpbGVfbGlzdCBbcGF0aF0gICAgICAgIC0gTGlzdCBkaXJlY3RvcnkgY29udGVudHMKLSBmaWxlX3JlYWQgW3BhdGhdICAgICAgIC0gRG93bmxvYWQgYSBmaWxlCi0gZmlsZV91cGxvYWQgW2xvY10gW3JlbV0gLSBVcGxvYWQgZmlsZSB0byB2aWN0aW0KLSBmaWxlX2RlbGV0ZSBbcGF0aF0gICAgIC0gRGVsZXRlIGZpbGUvZm9sZGVyCi0gemlwX2ZvbGRlciBbcGF0aF0gICAgICAtIENvbXByZXNzIGZvbGRlcgotIGF1dG9kb3dubG9hZCAgICAgICAgICAgLSBHcmFiIGZpbGVzIGZyb20gRGVza3RvcC9Eb2NzL0Rvd25sb2FkcwoKW/CflJJdIEVuY3J5cHRpb246Ci0gZW5jcnlwdCBbZmlsZV0gICAgICAgICAtIEVuY3J5cHQgZmlsZSAoQUVTLTI1NikKLSBkZWNyeXB0IFtmaWxlXSBba2V5XSAgIC0gRGVjcnlwdCBmaWxlCgpb8J+Wpe+4j10gU3lzdGVtIENvbnRyb2w6Ci0gc3lzaW5mbyAgICAgICAgICAgICAgICAtIEdldCBkZXRhaWxlZCBzeXN0ZW0gaW5mbwotIHRlcm1pbmF0ZSBbcHJvY2Vzc10gICAgLSBLaWxsIGEgcHJvY2VzcwotIGVzY2FsYXRlICAgICAgICAgICAgICAgLSBBdHRlbXB0IGFkbWluIHByaXZpbGVnZXMKLSBzaHV0ZG93biAgICAgICAgICAgICAgIC0gU2h1dGRvd24gc3lzdGVtCi0gcmVzdGFydCAgICAgICAgICAgICAgICAtIFJlc3RhcnQgc3lzdGVtCi0gbG9nb2ZmICAgICAgICAgICAgICAgICAtIExvZ29mZiBjdXJyZW50IHVzZXIKClvwn5O4XSBTdXJ2ZWlsbGFuY2U6Ci0gd2ViY2FtICAgICAgICAgICAgICAgICAtIFRha2Ugd2ViY2FtIHBob3RvCi0gc2NyZWVuc2hvdCAgICAgICAgICAgICAtIENhcHR1cmUgc2NyZWVuCi0gcmVjb3JkX21pYyBbc2Vjb25kc10gICAtIFJlY29yZCBtaWNyb3Bob25lCi0gcmVjb3JkX3NjcmVlbiBbc2Vjb25kc10tIFJlY29yZCBzY3JlZW4gYWN0aXZpdHkKClvijKjvuI9dIEtleWxvZ2dlcjoKLSBrZXlsb2dnZXIgc3RhcnQgICAgICAgIC0gU3RhcnQga2V5bG9nZ2VyCi0ga2V5bG9nZ2VyIHN0b3AgICAgICAgICAtIFN0b3Aga2V5bG9nZ2VyCi0ga2V5bG9nZ2VyIGR1bXAgICAgICAgICAtIEdldCBrZXlsb2dnZXIgZGF0YQoKW/CfjJBdIE5ldHdvcms6Ci0gd2lmaV9wYXNzd29yZHMgICAgICAgICAtIEdldCBzYXZlZCBXaUZpIHBhc3N3b3JkcwotIHBvcnRfc2NhbiBbaXBdIFtyYW5nZV0gLSBTY2FuIGZvciBvcGVuIHBvcnRzCgpb8J+Ti10gQ2xpcGJvYXJkOgotIGNsaXBib2FyZF9nZXQgICAgICAgICAgLSBHZXQgY2xpcGJvYXJkIGNvbnRlbnRzCi0gY2xpcGJvYXJkX3NldCBbdGV4dF0gICAtIFNldCBjbGlwYm9hcmQgdGV4dAoKW+Kame+4j10gT3RoZXI6Ci0gbWVsdCAgICAgICAgICAgICAgICAgICAtIFNlbGYtZGVzdHJ1Y3QgcGF5bG9hZAotIGhlbHAgICAgICAgICAgICAgICAgICAgLSBTaG93IHRoaXMgbWVudQotIGV4aXQgICAgICAgICAgICAgICAgICAgLSBDbG9zZSBjb25uZWN0aW9uCiIiIgogICAgICAgICAgICBzb2NrLnNlbmQoaGVscF90ZXh0LmVuY29kZSgpKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIG91dHB1dCA9IHN1YnByb2Nlc3MuZ2V0b3V0cHV0KGNtZCkKICAgICAgICAgICAgc29jay5zZW5kKG91dHB1dC5lbmNvZGUoKSkKICAgICAgICAgICAgc2F2ZV9sb2coZiJbK10gQ29tbWFuZDoge2NtZH1cbntvdXRwdXR9IikKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBzb2NrLnNlbmQoc3RyKGUpLmVuY29kZSgpKQogICAgICAgIHNhdmVfbG9nKGYiWy1dIENvbW1hbmQgZmFpbGVkOiB7Y21kfVxuRXJyb3I6IHtzdHIoZSl9IikKCmRlZiBjb25uZWN0X3RvX2MyKCk6CiAgICB3aGlsZSBUcnVlOgogICAgICAgIHRyeToKICAgICAgICAgICAgcyA9IHNvY2tldC5zb2NrZXQoKQogICAgICAgICAgICBzLnNldHRpbWVvdXQoMzApCiAgICAgICAgICAgIHByaW50KGYiWypdIFRyeWluZyB0byBjb25uZWN0IHRvIDE5Mi4xNjguMS43OjQ0NDQiKQogICAgICAgICAgICBzLmNvbm5lY3QoKCIxOTIuMTY4LjEuNyIsIDQ0NDQpKQogICAgICAgICAgICBzLnNldHRpbWVvdXQoTm9uZSkKICAgICAgICAgICAgc2F2ZV9sb2coIlsrXSBDb25uZWN0ZWQgdG8gQzIgc2VydmVyIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHMuc2VuZChqc29uLmR1bXBzKFZpY3RpbUNvbnRyb2wuZ2V0X2Z1bGxfaW5mbygpKS5lbmNvZGUoKSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgY21kID0gcy5yZWN2KDEwMjQpLmRlY29kZSgpLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgICBpZiBub3QgY21kOgogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIGlmIGNtZCA9PSAiZXhpdCI6CiAgICAgICAgICAgICAgICAgICAgICAgIFZpY3RpbUNvbnRyb2wuc3RvcF9rZXlsb2dnZXIoKQogICAgICAgICAgICAgICAgICAgICAgICBzLmNsb3NlKCkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgaGFuZGxlX2NvbW1hbmQocywgY21kKQogICAgICAgICAgICAgICAgZXhjZXB0IHNvY2tldC50aW1lb3V0OgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgc2F2ZV9sb2coZiJbLV0gQ29tbWFuZCBlcnJvcjoge3N0cihlKX0iKQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzYXZlX2xvZyhmIlstXSBDb25uZWN0aW9uIGVycm9yOiB7c3RyKGUpfSIpCiAgICAgICAgICAgIHRpbWUuc2xlZXAoMzApCgppZiBfX25hbWVfXyA9PSAiX19tYWluX18iOgogICAgaGlkZV9jb25zb2xlKCkKICAgIGFkZF90b19zdGFydHVwKCkKICAgIGNvbm5lY3RfdG9fYzIoKQo=').decode())